# 🔐 Kubesec - Kubernetes Workload Configuration Scanner

**Kubesec** is a lightweight security analysis tool that reviews your Kubernetes YAML manifests and highlights insecure settings.  
It evaluates objects like Pods, Deployments, etc., using a scoring system that helps quantify risk.

---

## 📤 Online YAML Scan via API

Use this for quick checks on your local manifest files without any plugin setup:

```bash
curl -sSX POST --data-binary @"your-deployment.yaml" https://v2.kubesec.io/scan
````

This sends the file to [https://kubesec.io](https://kubesec.io) and returns a detailed security analysis.

---

## 🔌 Kubesec via `kubectl` Plugin

Use this method if you'd like to run scans directly in your Kubernetes cluster from the CLI.

---

## STEP #1 — Install kubectl-kubesec Plugin

### A. 🧩 Install via Krew (Recommended)

[Krew](https://krew.sigs.k8s.io/) is a plugin manager for `kubectl`, similar to `apt` or `brew`.

#### Install Krew

```bash
(
  set -x; cd "$(mktemp -d)" &&
  OS="$(uname | tr '[:upper:]' '[:lower:]')" &&
  ARCH="$(uname -m | sed -e 's/x86_64/amd64/' -e 's/\(arm\)\(64\)\?.*/\1\2/' -e 's/aarch64$/arm64/')" &&
  KREW="krew-${OS}_${ARCH}" &&
  curl -fsSLO "https://github.com/kubernetes-sigs/krew/releases/latest/download/${KREW}.tar.gz" &&
  tar zxvf "${KREW}.tar.gz" &&
  ./"${KREW}" install krew
)
```

#### Add Krew to your PATH

```bash
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
```

Add it permanently in your shell config (e.g. `~/.bashrc` or `~/.zshrc`):

```bash
echo "export PATH=\"\${KREW_ROOT:-\$HOME/.krew}/bin:\$PATH\"" >> ~/.bashrc
```

#### Install the Kubesec Plugin via Krew

```bash
kubectl krew install kubesec-scan
```

---

### B. 🔽 Install via Direct Download (No Krew)

If you don’t want to install Krew, you can download the binary directly:

```bash
mkdir -p ~/.kube/plugins/scan && \
curl -sL https://github.com/controlplaneio/kubectl-kubesec/releases/download/1.0.0/kubectl-kubesec_1.0.0_`uname -s`_amd64.tar.gz | tar xzvf - -C ~/.kube/plugins/scan
mv ~/.kube/plugins/scan/scan ~/.kube/plugins/scan/kubectl-scan
export PATH=$PATH:~/.kube/plugins/scan
```

Add to your shell profile:

```bash
echo "export PATH=\$PATH:~/.kube/plugins/scan" >> ~/.bashrc
```

---

## STEP #2 — Start Using Kubesec Scan

```bash
kubectl kubesec-scan
kubectl kubesec-scan pod pod-name
kubectl kubesec-scan deployment deployment-name
```

These commands will fetch the manifest from the running cluster and evaluate it.

---

## 📌 USE CASE — Scan Insecure YAMLs

### Example 1: Pod With Excessive Permissions

Create a YAML file:

```bash
vim excess.yaml
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: excess-perms
spec:
  containers:
  - name: boxone
    image: lovelearnlinux/webserver:v1
    securityContext:
       privileged: True
       runAsUser: 0
       capabilities:
          add: ["CAP_SYS_ROOT"]
```

Run Kubesec scan:

```bash
kubesec scan excess.yaml
```

---

### Example 2: A Privileged Pod

Create the YAML:

```bash
vim dangerous.yaml
```

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: security-context-demo
spec:
  containers:
  - name: sec-ctx-demo
    image: busybox
    command: [ "sh", "-c", "sleep 1h" ]
    securityContext:
      privileged: true
```

Then scan it:

```bash
kubesec scan dangerous.yaml
```

---

## 📊 Kubesec Scoring Overview

| Score Range | Meaning                             |
| ----------- | ----------------------------------- |
| ≥ 10        | Excellent – strong security posture |
| 0 to 9      | Fair – some best practices missing  |
| < 0         | High risk – insecure by design      |

Use these scores to prioritize hardening your workloads. The goal is to reach a **positive score** with all high-risk elements eliminated.




### 1 - Generate a encryption key

```
head -c 32 /dev/urandom | base64
```

#### 2 - Create a encryption config file

```
vim /etc/kubernetes/enc/enc.yaml
```

```
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
  - resources:
      - secrets
    providers:
      - aescbc:
          keys:
            - name: keyone
              # See the following text for more details about the secret value
              secret: <paste key generated in step one here>
      - identity: {} # this fallback allows reading unencrypted secrets;
                     # for example, during initial migration
```

Next: we need to add this encryption config file in the kubernates api server 

* Note: so, take a backup of cpiserver file code, then modify *

```
cp /etc/kubernetes/manifests/kube-apiserver.yaml
```

```
vim /etc/kubernetes/manifests/kube-apiserver.yaml
```

```
- --encryption-provider-config=/etc/kubernetes/enc/enc.yaml   #add this line
- --encryption-provider-config-automatic-reload=true          #add this line
```

* Add the below lines under volumeMounts:*
```
- name: enc                           # add this line
  mountPath: /etc/kubernetes/enc      # add this line
  readOnly: true                      # add this line
```

* Then, add these below lines under volumes:
```
- name: enc                             # add this line
  hostPath:                             # add this line
    path: /etc/kubernetes/enc           # add this line
    type: DirectoryOrCreate             # add this line
```

Then, save and exit

### 4 - Now create another secret and check inside etcd

```
kubectl create secret generic sqlcreds --from-literal username=maho --from-literal password=sundaymonday
```

Now, lets check the secrets

```

cd /etc/kubernetes/manifest
cd /var/lib/etcd
cd member
cd snap
vim db
# then searh secrets like `/secret`, and it should not be as plain text now
```











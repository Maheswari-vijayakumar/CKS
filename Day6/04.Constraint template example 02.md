########################################################
#################### MORE EXAMPLES #####################
########################################################

#### Constraint Template for denying specific type of service

```
vim deny-service.yaml
```


```
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: lbtypesvcnotallowed
spec:
  crd:
    spec:
      names:
        kind: LBTypeSvcNotAllowed
        listKind: LBTypeSvcNotAllowedList
        plural: lbtypesvcnotallowed
        singular: lbtypesvcnotallowed
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package kubernetes.admission
        violation[{"msg": msg}] {
                    input.review.kind.kind = "Service"
                    input.review.operation = "CREATE"
                    input.review.object.spec.type = "LoadBalancer"
                    msg := "LoadBalancer Services are not permitted"
        }
```
```
kubectl apply -f deny-service.yaml
kubectl get contrainttemplate
```

```
vim deny-service-for-namespace.yaml
```

```
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: LBTypeSvcNotAllowed
metadata:
  name: deny-lb-type-svc-dev-ns
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Service"]
    namespaces:
      - "dev"
```

```
kubectl apply -f deny-service-for-namespace.yaml
kubectl get constraint
```

create a service with LB

```
vim dev-service.yaml
```

```
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: MyApp
  ports:
    - protocol: TCP
      port: 80
      targetPort: 9376
```

```
kubectl apply dev-service.yaml
```

you can see the error like you can't create the load balancer

$$$$$$$$$$$ REFERENCE FOR MORE EXAMPLES $$$$$$$$$$$$$$$$

https://github.com/open-policy-agent/gatekeeper-library/tree/master/library
https://open-policy-agent.github.io/gatekeeper-library/website/

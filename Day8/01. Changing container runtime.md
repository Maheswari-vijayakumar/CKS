# Migrate Node from CRI-O to Containerd

### 1. Drain the node

```bash
kubectl drain <node-to-drain> --ignore-daemonsets
```

---

### 2. Stop & disable CRI-O

```bash
systemctl stop kubelet
systemctl stop crio
systemctl disable crio
```

---

### 3. Install & configure Containerd

```bash
# Update packages & install prerequisites
sudo apt-get update
sudo apt-get install -y ca-certificates curl

# Create keyrings directory
sudo install -m 0755 -d /etc/apt/keyrings

# Download Docker GPG key
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add Docker apt repository
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] \
https://download.docker.com/linux/ubuntu \
$(. /etc/os-release && echo "$VERSION_CODENAME") stable" \
| sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Update & install containerd
sudo apt-get update
sudo apt-get install -y containerd.io

# Generate default config
sudo containerd config default > /etc/containerd/config.toml

# Enable systemd cgroup driver
sudo sed -i "/SystemdCgroup = false/c\            SystemdCgroup = true" /etc/containerd/config.toml

# Restart containerd
sudo systemctl restart containerd
```

Check service status:

```bash
systemctl status containerd.service
```

---

### 4. Configure kubelet to use Containerd

Edit kubelet flags:

```bash
vim /var/lib/kubelet/kubeadm-flags.env
```

Replace runtime endpoint with:

```
--container-runtime-endpoint=unix:///run/containerd/containerd.sock
```

Also update node config in Kubernetes:

```bash
kubectl edit node <node-name>
```

---

### 5. Restart kubelet

```bash
systemctl restart kubelet
```

---

### 6. Verify node status

```bash
kubectl get nodes -o wide
```

---



=> Pod level security, So security will inherit automatically to container as well

=> 1. Secure pod with non-root user

```
vim secure-non-root-pod.yaml
```

```
apiVersion: v1
kind: Pod
metadata:
  name: non-root-user-pod-demo
spec:
  securityContext:
    runAsNonRoot: true
  volumes:
  - name: demo-volume
    emptyDir: {}
  containers:
  - name: non-root-user-demo
    image: docker.io/demisto/iputils:1.0.0.62867
    command: [ "tail", "-f", "/dev/null" ]
    volumeMounts:
    - name: demo-volume
      mountPath: /data/demo
    securityContext:
      privileged: false
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
```

```
kubectl apply -f secure-non-root-pod.yaml
kubectl get pods
kubectl get pods/runasnonroot-pod-demo -ojson | jq .status.containerStatuses

# since configration is done with `runAsNonRoot: true` pod will not start and failed
# So let us delete the pod
kubectl delete pod secure-non-root-pod.yaml

# lets pass this in yaml
runAsUser: 1000
    runAsGroup: 3000
    fsGroup: 2000

```

=> complete yaml 

```
apiVersion: v1
kind: Pod
metadata:
  name: non-root-user-pod-demo
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 3000
    fsGroup: 2000
  volumes:
  - name: demo-volume
    emptyDir: {}
  containers:
  - name: non-root-user-demo
    image: docker.io/demisto/iputils:1.0.0.62867
    command: [ "tail", "-f", "/dev/null" ]
    volumeMounts:
    - name: demo-volume
      mountPath: /data/demo
    securityContext:
      privileged: false
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
```

```
kubectl apply -f secure-user-group-pod.yaml
kubectl get pods

Go inside the pod
id
touch /alok
touch /data/demo/aa
ping google.com
```


=> limited power, which means specific access or capabilities

```
vim specific-power.yaml
```

```
apiVersion: v1
kind: Pod
metadata:
  name: capability-pod-demo
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 3000
    fsGroup: 2000
  volumes:
  - name: demo-volume
    emptyDir: {}
  containers:
  - name: capability-demo
    image: demisto/iputils:1.0.0.62867
    command: [ "tail", "-f", "/dev/null" ]
    volumeMounts:
    - name: demo-volume
      mountPath: /data/demo
    securityContext:
      privileged: false
      allowPrivilegeEscalation: true
      capabilities:
        drop:
          - ALL
        add:
         - NET_RAW
```

```
kubectl apply -f specific-power.yaml
kubectl get pods

Go inside the container - kubectl exec -it pod-name -- sh
ping google.com

```


=> Next, work with Read only filesystem

```
vim readonly-pod.yaml
```

```
apiVersion: v1
kind: Pod
metadata:
  name: read-only-root-fs-pod-demo
spec:
  containers:
  - name: read-only-root-fs-demo
    image: docker.io/redhat/ubi8
    command: [ "tail", "-f", "/dev/null" ]
    securityContext:
      readOnlyRootFilesystem: true
```

```
kubectl apply -f readonly-pod.yaml
kubectl get pods
Go inside the pod - kubectl exec -it pod-name -- sh

touch alok
```




